var map;var infowindow;function initMap(){var b={lat:43.0389,lng:-87.9065};map=new google.maps.Map(document.getElementById("map"),{center:b,zoom:15,type:["store"]});infowindow=new google.maps.InfoWindow();var a=new google.maps.places.PlacesService(map);if(center_on.length<=0){a.nearbySearch({location:b,radius:5000},callback)}else{var c={placeId:center_on};a.getDetails(c,getPlace)}}function callback(c,a){if(a===google.maps.places.PlacesServiceStatus.OK){for(var b=0;b<c.length;b++){createMarker(c[b])}}}function getPlace(b,a){if(a===google.maps.places.PlacesServiceStatus.OK){createMarker(b);$("#title").append(b.name)}}function createMarker(c){var b=c.geometry.location;var a=new google.maps.Marker({map:map,position:c.geometry.location});google.maps.event.addListener(a,"click",function(){infowindow.setContent(c.name);infowindow.open(map,this);getInfo(c.place_id)})}function getInfo(a){var b={placeId:a};service=new google.maps.places.PlacesService(map);service.getDetails(b,setInfoCard)}function setInfoCard(b,a){if(a===google.maps.places.PlacesServiceStatus.OK){var c="";c+="<h1>"+b.name+"</h1>";var d=getRating(b.place_id,"#info_card");$("#info_card").html(c)}}function getRating(b,a){return $.ajax({type:"POST",data:{id:b,},url:base_url+"place/getPlaceRating",success:function(g){if(g!=false){var d=JSON.parse(g);var e="<div class='rating'><p>";var f=parseInt(d.average);console.log(f);for(var c=0;c<f;c++){e+="&Star;"}e+="<br />Based on "+d.total_votes+" votes!</p></div>";$(a).append(e)}else{var e="No ratings yet. <a href='"+base_url+"main/rate/"+b+"'>Add A Rating</a>";$(a).append(e)}}})};